<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pruebas Unitarias (Frontend)</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body class="p-4">
  <h1 class="h4 mb-3">Pruebas Unitarias (Frontend)</h1>
  <div id="results"></div>
  <script type="module">
    import '../assets/js/cart.js';
    import { Cart } from '../assets/js/cart.js';
    import { formatCurrency } from '../assets/js/utils.js';
    import { CONFIG } from '../assets/js/config.js';

    const results = document.getElementById('results');

    function log(ok, msg){
      const div = document.createElement('div');
      div.className = 'alert ' + (ok ? 'alert-success' : 'alert-danger');
      div.textContent = (ok? '✔︎ ' : '✘ ') + msg;
      results.appendChild(div);
    }

    // Test: cálculos del carrito
    (function(){
      const c = new Cart([]);
      c.addItem({id:'T1',name:'Test 1',price:1000}, 2);
      c.addItem({id:'T2',name:'Test 2',price:5000}, 1);
      log(c.totalItems()===3, 'Total de items');
      log(c.subtotal()===7000, 'Subtotal 2x1000 + 1x5000 = 7000');
      log(c.tax()===Math.round(7000*CONFIG.taxRate), 'Impuesto aplicado');
      log(c.total()===c.subtotal()+c.tax()+c.shipping(), 'Total = subtotal + impuesto + envío');
    })();

    // Test: actualización de cantidades y eliminación
    (function(){
      const c = new Cart([]);
      c.addItem({id:'X',name:'X',price:2000}, 1);
      c.updateQty('X', 5);
      log(c.items.find(i=>i.id==='X').qty===5, 'Actualizar cantidad');
      c.remove('X');
      log(c.items.length===0, 'Eliminar ítem');
    })();
  </script>
</body>
</html>
